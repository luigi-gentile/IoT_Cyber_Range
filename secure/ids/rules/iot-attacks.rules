# =============================================================================
# Suricata Rules — IoT MQTT Attack Detection
#
# Each rule targets a specific attack pattern demonstrated in the thesis.
# SIDs 9000001–9000007 are reserved for this research project.
# =============================================================================

# Rule 1: Plaintext MQTT connection attempt (should be TLS-only in secure arch)
alert tcp any any -> any 1883 (
    msg:"IOT MQTT Plaintext Connection Attempt";
    flow:to_server,established;
    content:"|10|"; offset:0; depth:1;
    classtype:policy-violation;
    sid:9000001; rev:1;
)

# Rule 2: Wildcard subscription '#' — characteristic of a traffic sniffer
alert tcp any any -> any 1883 (
    msg:"IOT MQTT Wildcard Subscription - Possible Sniffer";
    flow:to_server,established;
    content:"|82|";
    content:"|00 01 23|";
    classtype:attempted-recon;
    sid:9000002; rev:1;
)

# Rule 3: PUBLISH to a command topic — possible unauthorized command injection
alert tcp any any -> any 1883 (
    msg:"IOT MQTT Unauthorized Command Publish";
    flow:to_server,established;
    content:"|30|";
    content:"cmd";
    classtype:attempted-user;
    sid:9000003; rev:1;
)

# Rule 4: High-frequency PUBLISH — possible denial of service flood
alert tcp any any -> any 1883 (
    msg:"IOT MQTT Publish Flood - Possible DoS";
    flow:to_server,established;
    content:"|30|";
    threshold:type both, track by_src, count 50, seconds 10;
    classtype:attempted-dos;
    sid:9000004; rev:1;
)

# Rule 5: Port scan targeting the MQTT broker
alert tcp any any -> any 1883 (
    msg:"IOT Port Scan Targeting MQTT Broker";
    flags:S;
    threshold:type both, track by_src, count 5, seconds 5;
    classtype:attempted-recon;
    sid:9000005; rev:1;
)

# Rule 6: Anomalous sensor value in payload — characteristic of data poisoning
alert tcp any any -> any 1883 (
    msg:"IOT MQTT Anomalous Sensor Value - Possible Data Poisoning";
    flow:to_server,established;
    content:"|30|";
    content:"-99";
    classtype:bad-unknown;
    sid:9000006; rev:1;
)

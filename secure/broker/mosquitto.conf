# =============================================================================
# Mosquitto Configuration â€” SECURE
#
# Security controls implemented:
#   1. TLS 1.3 with mutual authentication (client cert required)
#   2. Anonymous access disabled
#   3. ACL file enforcing per-device topic restrictions
#   4. Rate limiting to mitigate DoS attacks
# =============================================================================

listener 8883
protocol mqtt

# Mutual TLS: broker and clients must both present valid certificates
cafile   /mosquitto/certs/ca.crt
certfile /mosquitto/certs/broker.crt
keyfile  /mosquitto/certs/broker.key
require_certificate true
use_identity_as_username true   # CN field of client cert becomes the username
tls_version tlsv1.3

# Authentication and authorization
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file      /mosquitto/config/acl

# Logging
log_type error
log_type warning
log_type notice
log_type information
log_dest stdout

# Persistence
persistence true
persistence_location /mosquitto/data/

# DoS mitigation
max_connections      50
max_inflight_messages 20
max_queued_messages  100
